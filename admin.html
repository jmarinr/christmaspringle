async function uploadCard(n){
  const pat = getPAT();
  if(!pat){ toast('Agrega el PAT en la sesión.','error'); return; }

  const fileInput = document.getElementById(`fileInput${n}`);
  const title = document.getElementById(`title${n}`).value.trim();
  const description = document.getElementById(`description${n}`).value.trim();
  const price = parseFloat(document.getElementById(`price${n}`).value);
  if(!fileInput.files[0] || !title || !description || !(price>0)){
    return toast('Completa imagen, título, descripción y precio.','error');
  }

  // >>> NUEVO: mostrar spinner
  showUploadSpinner(n);

  try{
    const file = fileInput.files[0];
    const fileName = `${n}.png`;
    const imageData = await convertToPNG(file);
    const base64Data = await blobToBase64(imageData);

    await uploadFileToGithub(fileName, base64Data);

    const idx = cardsData.findIndex(c=>c.number===n);
    const cardData = { number:n, title, description, price, image:fileName, uploadedAt:new Date().toISOString() };
    if(idx>=0) cardsData[idx]=cardData; else cardsData.push(cardData);
    cardsData.sort((a,b)=>a.number-b.number);

    await updateCardsJSON();
    toast(`Tarjeta #${n} subida.`, 'success');

    const preview = document.getElementById(`preview${n}`);
    preview.src = rawImageUrl(fileName);
    preview.style.display='block';
    renderSavedCards();

  }catch(err){
    if(String(err.message||'').includes('Bad credentials')){
      toast('Error de autenticación con GitHub (revisa PAT).','error');
    }else{
      toast(`Error: ${err.message||err}`, 'error', 5000);
    }
  }finally{
    // >>> NUEVO: ocultar spinner
    hideUploadSpinner(n);
  }
}
